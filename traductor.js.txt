// traductor.js

// Función principal para traducir texto
async function translateText() {
    // Obtener elementos del DOM
    const inputText = document.getElementById("textInput").value;
    const direction = document.getElementById("languageDirection").value;
    const resultDiv = document.getElementById("result");
    const loadingIndicator = document.getElementById("loading");
    
    // Validar que haya texto para traducir
    if (!inputText.trim()) {
        resultDiv.innerHTML = "⚠️ Por favor, escribe algo para traducir.";
        return;
    }
    
    // Mostrar indicador de carga
    loadingIndicator.style.display = "block";
    resultDiv.innerHTML = "";
    
    try {
        // Determinar la dirección de traducción
        const sourceLang = direction === "en-to-es" ? "inglés" : "español";
        const targetLang = direction === "en-to-es" ? "español" : "inglés";
        
        // Crear el prompt para la API
        const prompt = `Traduce el siguiente texto del ${sourceLang} al ${targetLang}: "${inputText}"`;
        
        // Realizar la solicitud a la API
        const translatedText = await callDeepSeekAPI(prompt);
        
        // Mostrar el resultado
        resultDiv.innerHTML = `
            <div class="translation-result">
                <h3>Traducción:</h3>
                <p>${translatedText}</p>
            </div>
        `;
    } catch (error) {
        console.error("Error:", error);
        resultDiv.innerHTML = "❌ Error al traducir. Por favor, intenta nuevamente.";
    } finally {
        // Ocultar indicador de carga
        loadingIndicator.style.display = "none";
    }
}

// Función para llamar a la API de DeepSeek
async function callDeepSeekAPI(prompt) {
    // IMPORTANTE: En producción, nunca expongas tu API Key en el frontend
    // Debes usar un backend para proteger tu clave API
    const apiKey = "sk-fa00b***********************6a86"; // Reemplaza con tu API Key de DeepSeek
    
    const response = await fetch("https://api.deepseek.com/v1/chat/completions", {
        method: "POST",
        headers: {
            "Authorization": `Bearer ${apiKey}`,
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            model: "deepseek-chat",
            messages: [
                {
                    role: "user",
                    content: prompt
                }
            ],
            max_tokens: 1000,
            temperature: 0.7
        })
    });
    
    if (!response.ok) {
        throw new Error(`Error en la API: ${response.status} ${response.statusText}`);
    }
    
    const data = await response.json();
    return data.choices[0].message.content;
}

// Función para alternar entre modos de traducción
function toggleTranslationDirection() {
    const directionSelect = document.getElementById("languageDirection");
    const currentValue = directionSelect.value;
    directionSelect.value = currentValue === "en-to-es" ? "es-to-en" : "en-to-es";
    updateButtonText();
}

// Actualizar texto del botón según la dirección
function updateButtonText() {
    const directionSelect = document.getElementById("languageDirection");
    const toggleBtn = document.getElementById("toggleDirection");
    
    if (directionSelect.value === "en-to-es") {
        toggleBtn.textContent = "Inglés → Español";
    } else {
        toggleBtn.textContent = "Español → Inglés";
    }
}

// Inicializar cuando el DOM esté cargado
document.addEventListener("DOMContentLoaded", function() {
    updateButtonText();
    
    // Agregar evento al botón de alternar dirección
    document.getElementById("toggleDirection").addEventListener("click", toggleTranslationDirection);
    
    // Agregar evento al botón de traducción
    document.getElementById("translateBtn").addEventListener("click", translateText);
    
    // Permitir traducción con Enter
    document.getElementById("textInput").addEventListener("keypress", function(e) {
        if (e.key === "Enter") {
            e.preventDefault();
            translateText();
        }
    });
});